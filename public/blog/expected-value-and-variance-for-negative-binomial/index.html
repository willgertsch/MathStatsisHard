<!DOCTYPE html>
<html lang="en-us">

<head>
  <title>Expected Value and Variance for Negative Binomial | Math Stats is Hard</title>

  <meta charset="UTF-8">
  <meta name="language" content="en">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  
  

  <link rel="shortcut icon" type="image/png" href="/favicon.ico" />

  
  
    
 
  
  
  
  
  
  
    
    <link type="text/css" rel="stylesheet" href="/css/post.min.2cb93c91050d1853bf971cc31e00122edd6e0f405aa1de3b7f8ef67ea3b5a79a.css" integrity="sha256-LLk8kQUNGFO/lxzDHgASLt1uD0Baod47f472fqO1p5o="/>
  
    
    <link type="text/css" rel="stylesheet" href="/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU="/>
  
  
   
   
    

<script type="application/ld+json">
  
    {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "\/"
      },
      "articleSection" : "blog",
      "name" : "Expected Value and Variance for Negative Binomial",
      "headline" : "Expected Value and Variance for Negative Binomial",
      "description" : "",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2020",
      "datePublished": "2020-07-21 00:00:00 \u002b0000 UTC",
      "dateModified" : "2020-07-21 00:00:00 \u002b0000 UTC",
      "url" : "\/blog\/expected-value-and-variance-for-negative-binomial\/",
      "wordCount" : "818",
      "keywords" : ["Blog"]
    }
  
  </script>
</head>

<body>
  <div class="burger__container">
  <div class="burger" aria-controls="navigation" aria-label="Menu">
    <div class="burger__meat burger__meat--1"></div>
    <div class="burger__meat burger__meat--2"></div>
    <div class="burger__meat burger__meat--3"></div>
  </div>
</div>
 

  <nav class="nav" id="navigation">
  <ul class="nav__list">
    
    
      <li>
        <a  href="/">about</a>
      </li>
    
      <li>
        <a  class="active"
         href="/blog">blog</a>
      </li>
    
  </ul>
</nav>


  <main>
    
    

    <div class="flex-wrapper">
      <div class="post__container">
        <div class="post">
          <header class="post__header">
            <h1 id="post__title">Expected Value and Variance for Negative Binomial</h1>
            <time datetime="2020-07-21 00:00:00 &#43;0000 UTC" class="post__date"
            >Jul 21 2020</time>
          </header>
          <article class="post__content">
              

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>The negative binomial distribution models the number of failures until <span class="math inline">\(r\)</span> successes given success probability <span class="math inline">\(p\)</span>. Its PMF is
<span class="math display">\[
P(X = k|r,p) = {k + r -1\choose k}(1-p)^kp^r
\]</span></p>
<p>for <span class="math inline">\(k = 0, 1, \dots\)</span>, $ r &gt; 0$, and <span class="math inline">\(0 &lt; p &lt; 1\)</span>.</p>
<p>There are two ways to compute the expected value and variance. The first is the direct method and the second uses the fact that the negative binomial distribution is part of the exponential family if <span class="math inline">\(r\)</span> is given.</p>
<div id="direct-method" class="section level2">
<h2>Direct method</h2>
<div id="expected-value" class="section level3">
<h3>Expected value</h3>
<p>This method proceeds directly from the definition of expectation.</p>
<p><span class="math display">\[
EX = \sum_{k=0}^\infty k {k + r -1\choose k}(1-p)^kp^r
\]</span>
First note that the <span class="math inline">\(k = 0\)</span> term will be zero, so we drop that term from the summation.
<span class="math display">\[
 = \sum_{k=1}^\infty k {k + r -1\choose k}(1-p)^kp^r
\]</span>
Next, bring k inside the <span class="math inline">\({k + r -1\choose k}\)</span>. This will cause damage, but will also tell us where to go next.</p>
<p><span class="math display">\[
 = \sum_{k=1}^\infty \frac{(k+r-1)!}{(k-1)! (r-1)!} (1-p)^kp^r
\]</span>
That <span class="math inline">\(k-1\)</span> is now our guiding light. If we can manufacture a negative binomial PMF inside the summation in terms of <span class="math inline">\(k-1\)</span>, it will sum to 1 and we will be left with terms that we can pull out.</p>
<p>Our first step is to try to turn the fraction into <span class="math inline">\({k + r -1\choose k-1}\)</span>.
<span class="math display">\[
 = \sum_{k=1}^\infty \frac{(k-1+r+1-1)!}{(k-1)! (r-1)!} (1-p)^kp^r
\]</span>
The second term on the bottom needs to be <span class="math inline">\(k-1 + r + 1 - 1 - (k-1) = r\)</span>, so multiply by <span class="math inline">\(\frac{r}{r}\)</span>.
<span class="math display">\[
 = \sum_{k=1}^\infty \frac{r}{r} \frac{(k-1+r+1-1)!}{(k-1)! (r-1)!} (1-p)^kp^r = r\sum_{k=1}^\infty \frac{(k+r-1)!}{(k-1)! r!} (1-p)^kp^r 
\]</span>
<span class="math display">\[
= r\sum_{k=1}^\infty  {k + r -1\choose k-1}(1-p)^kp^r
\]</span>
Our goal is to make a negative binomial distribution in terms of <span class="math inline">\(k-1\)</span>. We can make that process easier with the substitution <span class="math inline">\(z = k-1\)</span>.
<span class="math display">\[
= r\sum^\infty_{z = 0} { z + 1 +r - 1\choose z}p^r(1-p)^{z+1}
\]</span>
Now we need to manipulate the <span class="math inline">\(p\)</span> and the <span class="math inline">\((1-p)\)</span> terms to match the first term.</p>
<p><span class="math display">\[
= \frac{r(1-p)}{p}\sum^\infty_{z = 0} { z + 1 +r - 1\choose z}p^{r+1}(1-p)^{z}
\]</span>
The summation is now over a negative binomial PMF with parameters <span class="math inline">\(r+1\)</span>, <span class="math inline">\(p\)</span>. Therefore
<span class="math display">\[
EX = \frac{r(1-p)}{p}
\]</span></p>
</div>
</div>
<div id="variance" class="section level2">
<h2>Variance</h2>
<p>Finding the variance requires a different method than for the expectation. Instead of computing <span class="math inline">\(EX^2\)</span> and using it to compute <span class="math inline">\(\operatorname{Var}X = EX^2 - (EX)^2\)</span>, it is easier to compute <span class="math inline">\(E\left[X(X-1)\right]\)</span> use it to find <span class="math inline">\(\operatorname{Var}X = EX^2 -EX + EX- (EX)^2\)</span>
<span class="math display">\[
E\left[X(X-1)\right] = \sum_{k=0}^\infty k(k-1) {k + r -1\choose k}(1-p)^kp^r
\]</span>
Like before, we first consider the damage done by <span class="math inline">\(k(k-1)\)</span>.</p>
<p><span class="math display">\[
= \sum_{k=0}^\infty k(k-1) \frac{(k+r-1)!}{(k-2)!(r-1)!}(1-p)^kp^r
\]</span></p>
<p>Similarly, we can modify the <span class="math inline">\(r\)</span> component to get to <span class="math inline">\({k+r-1 \choose k-2}\)</span></p>
<p><span class="math display">\[
=r(r+1)\sum_{k=0}^\infty {k+r-1 \choose k-2}(1-p)^kp^r
\]</span></p>
<p>Now let <span class="math inline">\(z = k-2\)</span>.</p>
<p><span class="math display">\[
 = r(r+1)\sum_{k=0}^\infty {z+r+2-1 \choose k}(1-p)^{z + 2}p^r
\]</span></p>
<p>Pull out the constant terms as before and we end up with
<span class="math display">\[
E\left[X(X-1)\right] = \frac{r(r+1)(1-p)^2}{p^2}
\]</span></p>
<p>Thus the variance is
<span class="math display">\[
\operatorname{Var}X = EX^2 -EX + EX- (EX)^2 = E\left[X(X-1)\right]+ EX- (EX)^2
\]</span></p>
<p><span class="math display">\[
= \frac{r(r+1)(1-p)^2}{p^2} + \frac{r(1-p)}{p} - \frac{r^2(1-p)^2}{p^2} = \frac{r(1-p)}{p^2}
\]</span></p>
</div>
<div id="exponential-family-method" class="section level2">
<h2>Exponential family method</h2>
<p>The direct method is long, tedious, and requires a number of tricks that are difficult to come up with the first time through. Being familiar with the exponential family of distributions can help you skip these calculations.</p>
<p>A pdf/pmf of a distribution in the exponential family can be put into <em>canonical form</em> as follows.
<span class="math display">\[
f(y | \theta, \phi) = h(y, \phi)\operatorname{exp}\left[ \frac{y\theta - A(\theta)}{d(\phi)}\right]
\]</span></p>
<p>where <span class="math inline">\(\theta\)</span> is the <em>canonical parameter</em> and <span class="math inline">\(\phi\)</span> is the <em>dispersion parameter</em>.</p>
<p>Canonical form is most often used in GLMs to find the canonical link function, but there are a few other nice features. One of these is that there are easy formulas for expectation and variance.</p>
<p><span class="math display">\[
EX = \frac{\partial}{\partial\theta}A(\theta)
\]</span>
<span class="math display">\[
\operatorname{Var}(X) = \frac{\partial^2}{\partial\theta^2}A(\theta)
\]</span>
Therefore, if we want to find expectation and variance, we can put the pdf/pmf into canonical form and then take derivatives of <span class="math inline">\(A(\theta)\)</span>.</p>
<p>Given <span class="math inline">\(r\)</span>, the negative binomial distribution is part of the exponential family and therefore can be put into canonical form.
<span class="math display">\[
P(X = k|r,p) = {k + r -1\choose k}(1-p)^kp^r  
\]</span></p>
<p><span class="math display">\[
 = \operatorname{exp}\left[ x\log(1-p) + r\log p + \log {k + r -1\choose k}\right]
\]</span></p>
<p><span class="math display">\[
= {k + r -1\choose k} \operatorname{exp} \left[ x\log(1-p) +r\log p \right]
\]</span></p>
<p>Therefore we have <span class="math inline">\(\theta = \log(1-p)\)</span>. We also have <span class="math inline">\(A(\theta)\)</span>, but it is not in terms of <span class="math inline">\(\theta\)</span>, which makes taking derivatives difficult. We must find a function <span class="math inline">\(A\)</span> such that <span class="math inline">\(A(\log(1-p)) = -r\log p\)</span>.</p>
<p>Playing around with applying various operations to <span class="math inline">\(\log(1-p)\)</span>, we find that the function is <span class="math inline">\(A(\theta) = -r \log \left( 1- e ^\theta \right)\)</span></p>
<p>Now we can take first and second derivatives to get
<span class="math display">\[
EX = \frac{\partial}{\partial\theta}A(\theta) = \frac{re^\theta}{1-e^\theta} = \frac{r(1-p)}{p}
\]</span></p>
<p><span class="math display">\[
\operatorname{Var}(X) = \frac{\partial^2}{\partial\theta^2}A(\theta) = \frac{re^\theta}{(1-e^\theta)^2} = \frac{r(1-p)}{p^2}
\]</span></p>
<p>Note that the last step was achieved with the substitution <span class="math inline">\(\theta = \log(1-p)\)</span>.</p>
</div>


              
                  

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
            showMathMenu: false, //disables context menu
            tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ]
           }
    });
</script>
              
          </article>
          

<ul class="tags__list">
    
    <li class="tag__item">
        <a class="tag__link" href="/tags/expectation/">expectation</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="/tags/variance/">variance</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="/tags/discrete/">discrete</a>
    </li>
    <li class="tag__item">
        <a class="tag__link" href="/tags/negative-binomial/">negative-binomial</a>
    </li></ul>

 <div class="pagination">
  
    <a class="pagination__item" href="/blog/intro-to-glms/">
        <span class="pagination__label">Previous Post</span>
        <span class="pagination__title">Intro to GLMs</span>
    </a>
  

  
    <a class="pagination__item" href="/blog/completing-the-square-for-a-multivariate-normal/">
      <span class="pagination__label">Next Post</span>
      <span class="pagination__title" >Completing the Square for a Multivariate Normal</a>
    </a>
  
</div>

          
          <footer class="post__footer">
            


<div class="social-icons">
  
     
    
  
     
    
      <a class="social-icons__link" title="GitHub"
         href="https://github.com/willgertsch"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('/svg/github.svg')"></div>
      </a>
    
  
     
    
      <a class="social-icons__link" title="Email"
         href="mailto:willgertsch&#43;mathstatsishard@gmail.com"
         target="_blank" rel="noopener">
        <div class="social-icons__icon" style="background-image: url('/svg/email.svg')"></div>
      </a>
    
  
     
    
  
     
    
  
     
    
  
     
    
  
     
    
     
</div>

            <p>© 2021</p>
          </footer>
          </div>
      </div>
      
    </div>
    

  </main>

   

  
  <script src="/js/index.min.49e4d8a384357d9b445b87371863419937ede9fa77737522ffb633073aebfa44.js" integrity="sha256-SeTYo4Q1fZtEW4c3GGNBmTft6fp3c3Ui/7YzBzrr&#43;kQ=" crossorigin="anonymous"></script>
  
  
  <script src="https://unpkg.com/prismjs@1.20.0/components/prism-core.min.js"></script>

  
  <script src="https://unpkg.com/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"
    data-autoloader-path="https://unpkg.com/prismjs@1.20.0/components/"></script>

  


</body>

</html>
